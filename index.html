<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°‡∏Ç‡∏≠‡∏á‡∏ä‡∏°‡∏£‡∏°‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô</title>
    <link rel="icon" type="image/png" href="https://placehold.co/32x32/3b82f6/ffffff?text=LOGO">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Base styles */
        body {
            font-family: 'Kanit', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
            transition: background-color 0.3s ease;
        }
        .card, .control-panel, .modal-container {
            transition: background-color 0.3s ease, border-color 0.3s ease;
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .modal-video {
            position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;
        }
        .modal-video iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        .filter-btn.active {
            background-color: #2563eb; /* blue-600 */
            color: white;
        }
        select {
            -webkit-appearance: none; -moz-appearance: none; appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
            background-position: right 0.5rem center; background-repeat: no-repeat; background-size: 1.5em 1.5em; padding-right: 2.5rem;
        }
        .gallery-thumbnail.active {
            border-color: #3b82f6; /* blue-500 */
            opacity: 1;
        }

        /* Dark mode styles */
        .dark body {
            background-color: #111827; /* gray-900 */
        }
        .dark .control-panel, .dark .card, .dark .modal-container {
            background-color: #1f2937; /* gray-800 */
            border-color: #374151; /* gray-700 */
        }
        .dark .text-color-primary { color: #d1d5db; /* gray-300 */ }
        .dark .text-color-secondary { color: #9ca3af; /* gray-400 */ }
        .dark .input-bg { background-color: #374151; /* gray-700 */ }
        .dark .info-box { background-color: #374151; /* gray-700 */ }
        .dark .modal-footer-bg { background-color: #374151; /* gray-700 */ border-top-color: #4b5563; }
        .dark select {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%239ca3af' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
             color: #d1d5db; /* gray-300 */
        }
    </style>
</head>
<body>

    <div id="mainApp" class="container mx-auto p-4 md:p-6">
        <div class="control-panel bg-white p-4 rounded-xl shadow-md mb-6 sticky top-4 z-10">
            <!-- [CHANGED] Restructured Header Layout -->
            <!-- Top Row -->
            <div class="flex justify-between items-center gap-4">
                <!-- Left: Logo and Title -->
                <div class="flex items-center gap-3">
                    <img src="https://scontent.fbkk12-5.fna.fbcdn.net/v/t39.30808-6/514589111_689431527587902_7224037195547545665_n.jpg?_nc_cat=107&ccb=1-7&_nc_sid=6ee11a&_nc_ohc=1x06Jq8b4xwQ7kNvwFl2G5N&_nc_oc=AdmyDnucRGuYqd6gzLjVbFpYoRKbLrF4QjA2OJB6_DE-5WIXg1NXEirCWF_dsDnvqkr2ThnOumNmusPnYufTTF9m&_nc_zt=23&_nc_ht=scontent.fbkk12-5.fna&_nc_gid=lSMg2CXZRHYsLtTbnimJ2A&oh=00_AfOUtAWdAGHrRBDeAXDGQoEq6pA37ZXuGdCJWE50yQQHAA&oe=68685B2E" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏ä‡∏°‡∏£‡∏°" class="w-14 h-14 rounded-full object-cover shadow-md">
                    <h2 class="text-xl md:text-2xl font-bold text-color-primary text-gray-700 whitespace-nowrap">‡∏ä‡∏°‡∏£‡∏°‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°‡πÅ‡∏•‡∏∞‡∏´‡∏°‡∏≤‡∏Å‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô</h2>
                </div>
                <!-- Right: Refresh and Theme Toggle -->
                <div class="flex items-center gap-2">
                    <button id="fetchDataBtn" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors flex-shrink-0">
                        üîÑ ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
                    </button>
                    <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                        <svg id="theme-toggle-dark-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-.707 12.02l.707-.707a1 1 0 011.414 1.414l-.707.707a1 1 0 01-1.414-1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </div>
            <!-- Bottom Row -->
            <div class="flex justify-between items-center gap-4 mt-4">
                <!-- Left: Search -->
                <div class="flex-grow">
                    <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏Å‡∏°... üîç" class="input-bg w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white">
                </div>
                <!-- Right: Filter Button -->
                <div class="flex-shrink-0">
                     <button id="openFilterBtn" class="bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors input-bg text-color-primary">
                        ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á ‚ò∞
                    </button>
                </div>
            </div>
        </div>

        <div id="gameGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8"></div>
    </div>

    <!-- Game Details Modal -->
    <div id="gameModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4">
        <div id="modalContent" class="modal-container bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto"></div>
    </div>
    
    <!-- Filter Modal -->
    <div id="filterModal" class="fixed inset-0 bg-black bg-opacity-60 hidden items-center justify-center z-50 p-4">
        <div class="modal-container bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <div class="p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-2xl font-bold text-color-primary text-gray-800">‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h3>
                    <button id="closeFilterBtn" class="text-gray-400 hover:text-gray-600 text-3xl">&times;</button>
                </div>
                <div class="space-y-6">
                    <div>
                        <label class="font-semibold text-color-primary text-gray-700 mb-2 block">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                        <div id="categoryFilters" class="flex flex-wrap gap-2"></div>
                    </div>
                    <div>
                        <label for="difficultyFilter" class="font-semibold text-color-primary text-gray-700 mb-2 block">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</label>
                        <select id="difficultyFilter" class="input-bg text-color-primary w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"></select>
                    </div>
                    <div>
                        <label for="playerFilter" class="font-semibold text-color-primary text-gray-700 mb-2 block">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î</label>
                        <select id="playerFilter" class="input-bg text-color-primary w-full p-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400"></select>
                    </div>
                </div>
            </div>
            <div class="modal-footer-bg bg-gray-50 p-4 flex justify-end gap-4 rounded-b-2xl border-t">
                <button id="resetFiltersBtn" class="bg-gray-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-gray-600 transition-colors">‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</button>
                <button id="applyAndCloseFilterBtn" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô</button>
            </div>
        </div>
    </div>


    <script>
        // --- DOM Elements ---
        const searchInput = document.getElementById('searchInput');
        const openFilterBtn = document.getElementById('openFilterBtn');
        const closeFilterBtn = document.getElementById('closeFilterBtn');
        const applyAndCloseFilterBtn = document.getElementById('applyAndCloseFilterBtn');
        const filterModal = document.getElementById('filterModal');
        const categoryFilters = document.getElementById('categoryFilters');
        const difficultyFilter = document.getElementById('difficultyFilter');
        const playerFilter = document.getElementById('playerFilter');
        const resetFiltersBtn = document.getElementById('resetFiltersBtn');
        const gameGrid = document.getElementById('gameGrid');
        const gameModal = document.getElementById('gameModal');
        const modalContent = document.getElementById('modalContent');
        const themeToggleButton = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');
        const fetchDataBtn = document.getElementById('fetchDataBtn');
        
        // --- App State ---
        let allGames = [];
        let currentFilters = { category: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', difficulty: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', players: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' };
        const G_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwFTdSepLjFO5K8JwC--91QmBy8Iq4btFiNytuuOrMTlLOImjEGmxHFUwbQZLaAlgPrXw/exec';

        // --- Theme Toggle Logic ---
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            themeToggleLightIcon.classList.remove('hidden');
        } else {
            document.documentElement.classList.remove('dark');
            themeToggleDarkIcon.classList.remove('hidden');
        }

        themeToggleButton.addEventListener('click', function() {
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                }
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                }
            }
        });


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', loadInitialData);
        searchInput.addEventListener('input', applyAllFilters);
        fetchDataBtn.addEventListener('click', () => fetchData(true));
        
        openFilterBtn.addEventListener('click', () => filterModal.classList.remove('hidden'));
        closeFilterBtn.addEventListener('click', () => filterModal.classList.add('hidden'));
        applyAndCloseFilterBtn.addEventListener('click', () => filterModal.classList.add('hidden'));

        difficultyFilter.addEventListener('change', (e) => {
            currentFilters.difficulty = e.target.value;
            applyAllFilters();
        });
        playerFilter.addEventListener('change', (e) => {
            currentFilters.players = e.target.value;
            applyAllFilters();
        });
        resetFiltersBtn.addEventListener('click', () => {
            searchInput.value = '';
            currentFilters = { category: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', difficulty: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', players: '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' };
            renderAllFilters();
            applyAllFilters();
        });
        gameModal.addEventListener('click', (e) => {
            if (e.target === gameModal) closeModal();
        });
        filterModal.addEventListener('click', (e) => {
            if (e.target === filterModal) filterModal.classList.add('hidden');
        });

        // --- Data Handling ---
        function loadInitialData() {
            const storedData = localStorage.getItem('boardGamesData');
            if (storedData) {
                try {
                    allGames = JSON.parse(storedData);
                    if (allGames && allGames.length > 0) renderUI();
                    else fetchData();
                } catch (error) {
                    localStorage.removeItem('boardGamesData');
                    fetchData();
                }
            } else {
                fetchData();
            }
        }

        function fetchData() {
            Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
            const callbackName = 'handleData';
            const script = document.createElement('script');
            script.src = `${G_SCRIPT_URL}?callback=${callbackName}`;
            document.body.appendChild(script);
            script.onload = () => document.body.removeChild(script);
            script.onerror = () => {
                 Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ' });
                 document.body.removeChild(script);
            };
        }

        window.handleData = (data) => {
            if (data && data.status === "success") {
                allGames = data.data;
                localStorage.setItem('boardGamesData', JSON.stringify(allGames));
                renderUI();
                Swal.fire({ icon: 'success', title: '‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', showConfirmButton: false, timer: 1500 });
            } else {
                Swal.fire({ icon: 'error', title: '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', text: data.message || '‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' });
            }
        };

        // --- Rendering ---
        function renderUI() {
            renderAllFilters();
            applyAllFilters();
        }

        function getDifficultyHTML(difficulty) {
            const difficultyText = difficulty || '-';
            switch (String(difficulty).trim()) {
                case '‡∏á‡πà‡∏≤‡∏¢': return `<span class="font-semibold text-green-500">${difficultyText}</span>`;
                case '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á': return `<span class="font-semibold text-orange-500">${difficultyText}</span>`;
                case '‡∏¢‡∏≤‡∏Å': return `<span class="font-semibold text-red-500">${difficultyText}</span>`;
                default: return `<span class="text-gray-500 dark:text-gray-400">${difficultyText}</span>`;
            }
        }
        
        function getMaxPlayers(range) {
            if (!range) return null;
            const rangeStr = String(range).trim();
            if (rangeStr.includes('+')) {
                return rangeStr;
            }
            if (rangeStr.includes('-')) {
                return parseInt(rangeStr.split('-')[1], 10);
            }
            const num = parseInt(rangeStr, 10);
            return isNaN(num) ? null : num;
        }

        // --- Filter Logic ---
        function applyAllFilters() {
            const searchTerm = searchInput.value.toLowerCase();
            let filteredGames = allGames;

            if (searchTerm) {
                filteredGames = filteredGames.filter(game => (game['‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°'] || '').toLowerCase().includes(searchTerm));
            }
            if (currentFilters.category !== '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') {
                filteredGames = filteredGames.filter(game => game['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] === currentFilters.category);
            }
            if (currentFilters.difficulty !== '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') {
                filteredGames = filteredGames.filter(game => game['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å'] === currentFilters.difficulty);
            }
            if (currentFilters.players !== '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î') {
                filteredGames = filteredGames.filter(game => {
                    const maxPlayers = getMaxPlayers(game['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô']);
                    return String(maxPlayers) === currentFilters.players;
                });
            }
            
            renderGameCards(filteredGames);
            updateActiveCategoryButton();
        }

        function renderAllFilters() {
            const categories = ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', ...new Set(allGames.map(g => g['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà']).filter(Boolean))];
            categoryFilters.innerHTML = '';
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'filter-btn px-3 py-1 text-sm font-medium rounded-full transition-colors bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600';
                button.textContent = category;
                button.dataset.category = category;
                button.addEventListener('click', () => {
                    currentFilters.category = category;
                    applyAllFilters();
                });
                categoryFilters.appendChild(button);
            });
            updateActiveCategoryButton();

            const difficulties = ['‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏á‡πà‡∏≤‡∏¢', '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á', '‡∏¢‡∏≤‡∏Å'];
            difficultyFilter.innerHTML = difficulties.map(d => `<option value="${d}">${d === '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ? '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : d}</option>`).join('');
            difficultyFilter.value = currentFilters.difficulty;

            const playerOptions = new Set();
            allGames.forEach(game => {
                const max = getMaxPlayers(game['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô']);
                if (max !== null) playerOptions.add(max);
            });
            const sortedPlayers = Array.from(playerOptions).sort((a, b) => {
                const numA = parseInt(a, 10);
                const numB = parseInt(b, 10);
                if (numA !== numB) return numA - numB;
                return String(a).localeCompare(String(b));
            });
            playerFilter.innerHTML = '<option value="‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î">‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>' + sortedPlayers.map(p => `<option value="${p}">${p} ‡∏Ñ‡∏ô</option>`).join('');
            playerFilter.value = currentFilters.players;
        }
        
        function updateActiveCategoryButton() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                if (btn.dataset.category === currentFilters.category) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
        }

        function renderGameCards(gamesToRender) {
            gameGrid.innerHTML = '';
            if (!gamesToRender || gamesToRender.length === 0) {
                gameGrid.innerHTML = `<p class="text-gray-500 dark:text-gray-400 col-span-full text-center py-10">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô</p>`;
                return;
            }

            gamesToRender.forEach(game => {
                const name = game['‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°'] || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠';
                const category = game['‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'] || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà';
                const players = game['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô'] || '-';
                const difficulty = game['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å']; 
                const imageUrl = game['‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'] || 'https://placehold.co/600x400/e0f2f1/333?text=No+Image';

                const card = document.createElement('div');
                card.className = 'card bg-white rounded-xl shadow-md overflow-hidden cursor-pointer';
                card.addEventListener('click', () => openModal(game));

                const img = document.createElement('img');
                img.className = 'w-full h-60 object-cover';
                img.src = imageUrl;
                img.alt = `‡∏†‡∏≤‡∏û‡∏õ‡∏Å‡πÄ‡∏Å‡∏° ${name}`;
                img.onerror = function() { this.onerror = null; this.src = 'https://placehold.co/600x400/e0f2f1/333?text=Error'; };

                const contentDiv = document.createElement('div');
                contentDiv.className = 'p-5';

                const h3 = document.createElement('h3');
                h3.className = 'font-bold text-lg truncate text-color-primary text-gray-800';
                h3.textContent = name;

                const pCategory = document.createElement('p');
                pCategory.className = 'text-sm text-color-secondary text-gray-600 mt-1';
                pCategory.innerHTML = `‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà: <span class="font-semibold text-blue-600">${category}</span>`;

                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'flex justify-between items-center mt-2 text-sm text-color-secondary text-gray-500';

                const spanPlayers = document.createElement('span');
                spanPlayers.innerHTML = `<svg class="w-5 h-5 inline-block -mt-1 mr-1 text-blue-600 dark:text-blue-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path></svg> ${players}`;

                const spanDifficulty = document.createElement('span');
                spanDifficulty.innerHTML = `‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å: ${getDifficultyHTML(difficulty)}`;

                detailsDiv.appendChild(spanPlayers);
                detailsDiv.appendChild(spanDifficulty);
                contentDiv.appendChild(h3);
                contentDiv.appendChild(pCategory);
                contentDiv.appendChild(detailsDiv);
                card.appendChild(img);
                card.appendChild(contentDiv);
                gameGrid.appendChild(card);
            });
        }

        // --- Modal ---
        function openModal(game) {
            const name = game['‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÄ‡∏Å‡∏°'];
            const players = game['‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô'];
            const difficulty = game['‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å'];
            const location = game['‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà'];
            const description = game['‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'];
            const videoUrl = game['‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô'];
            
            const coverImage = game['‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'];
            const galleryImagesStr = game['‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°'];
            let allImages = [];
            if (coverImage) {
                allImages.push(coverImage);
            }
            if (galleryImagesStr) {
                const additionalImages = galleryImagesStr.split(',').map(url => url.trim()).filter(url => url);
                allImages.push(...additionalImages);
            }
            
            let galleryHTML = '';
            if (allImages.length > 0) {
                galleryHTML = `
                    <div class="mb-6">
                        <h3 class="font-semibold text-xl text-color-primary text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</h3>
                        <img id="galleryMainImage" src="${allImages[0]}" alt="‡∏†‡∏≤‡∏û‡πÄ‡∏Å‡∏°" class="w-full h-auto rounded-lg shadow-lg mb-3 object-contain max-h-[50vh]">
                `;

                if (allImages.length > 1) {
                    galleryHTML += `<div id="galleryThumbnails" class="flex flex-wrap gap-2 justify-center">`;
                    allImages.forEach((imgUrl, index) => {
                        galleryHTML += `
                            <img src="${imgUrl}" class="gallery-thumbnail w-20 h-20 rounded-md object-cover cursor-pointer border-2 ${index === 0 ? 'border-blue-500' : 'border-transparent'}" onclick="updateMainImage(this, '${imgUrl}')">
                        `;
                    });
                    galleryHTML += `</div>`;
                }
                galleryHTML += `</div>`;
            }
            
            const embedUrl = convertToEmbedUrl(videoUrl);

            modalContent.innerHTML = `
                <div class="p-5 md:p-8">
                    <div class="flex justify-between items-start mb-4">
                        <h2 class="text-3xl font-bold text-color-primary text-gray-800">${name}</h2>
                        <button onclick="closeModal()" class="text-gray-500 hover:text-red-500 text-3xl">√ó</button>
                    </div>

                    ${galleryHTML}

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
                        <div class="info-box bg-yellow-100 p-4 rounded-lg text-center">
                            <div class="text-yellow-600 dark:text-yellow-500 mb-1">
                                <svg class="w-8 h-8 mx-auto" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"></path></svg>
                            </div>
                            <div class="font-semibold text-color-primary text-gray-800">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</div>
                            <div class="text-color-secondary text-gray-600">${players}</div>
                        </div>
                        <div class="info-box bg-green-100 p-4 rounded-lg text-center">
                            <div class="font-semibold mb-2 text-color-primary text-gray-800">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏Å</div>
                            <div class="text-xl">${getDifficultyHTML(difficulty)}</div>
                        </div>
                        <div class="info-box bg-pink-100 p-4 rounded-lg text-center">
                            <div class="text-2xl mb-1">üìç</div>
                            <div class="font-semibold text-color-primary text-gray-800">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</div>
                            <div class="text-color-secondary text-gray-600">${location}</div>
                        </div>
                    </div>
                    <div class="space-y-4">
                        <div><h3 class="font-semibold text-xl text-color-primary text-gray-700 mb-2">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏Å‡∏°</h3><p class="text-color-secondary text-gray-600 whitespace-pre-wrap">${description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢'}</p></div>
                        ${embedUrl ? `<div><h3 class="font-semibold text-xl text-color-primary text-gray-700 mb-2">‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô</h3><div class="modal-video rounded-lg overflow-hidden shadow-lg"><iframe src="${embedUrl}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></div></div>` : ''}
                    </div>
                </div>
            `;
            gameModal.classList.remove('hidden');
            gameModal.classList.add('flex');
            document.body.style.overflow = 'hidden';
        }

        function updateMainImage(selectedThumbnail, imageUrl) {
            document.getElementById('galleryMainImage').src = imageUrl;
            document.querySelectorAll('.gallery-thumbnail').forEach(thumb => {
                thumb.classList.remove('border-blue-500');
                thumb.classList.add('border-transparent');
            });
            selectedThumbnail.classList.add('border-blue-500');
            selectedThumbnail.classList.remove('border-transparent');
        }

        function closeModal() {
            modalContent.innerHTML = '';
            gameModal.classList.add('hidden');
            gameModal.classList.remove('flex');
            document.body.style.overflow = 'auto';
        }

        function convertToEmbedUrl(url) {
            if (!url) return null;
            let videoId = null;
            try {
                if (url.includes('youtube.com/watch?v=')) {
                    videoId = new URL(url).searchParams.get('v');
                } else if (url.includes('youtu.be/')) {
                    videoId = new URL(url).pathname.split('/').pop();
                }
            } catch (error) {
                console.error("Error parsing video URL:", error);
                return null;
            }
            return videoId ? `https://www.youtube.com/embed/${videoId}` : null;
        }
    </script>
</body>
</html>
